{% extends "base.html" %}
{% set title = "Solicitudes" %}

{% block content %}
  <h1>Solicitudes (últimas 50)</h1>

  <section class="card">
    <form method="POST" action="{{ url_for('borrar_solicitudes') }}">
      <div class="table-actions">
        <label class="checkline">
          <input id="checkAll" type="checkbox">
          <span>Seleccionar todo</span>
        </label>

        <button class="btn-danger" type="submit" id="btnDelete" disabled>
          Borrar seleccionadas
        </button>

        <div class="muted" id="countSel">0 seleccionadas</div>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th></th>
              <th>ID</th>
              <th>Dueño</th>
              <th>Tel</th>
              <th>Vivienda</th>
              <th>Dirección</th>
              <th>Torre</th>
              <th>Apto</th>
              <th>Instrucciones</th>
              <th>Turno</th>
              <th>Franja</th>
              <th>Fecha</th>
              <th>Mascota</th>
              <th>Especie</th>
              <th>Raza</th>
              <th>Edad</th>
              <th>Muestra</th>
              <th>¿Cuál?</th>
              <th>Condición</th>
              <th>Estado</th>
              <th>Creado</th>
            </tr>
          </thead>
          <tbody>
            {% for s in solicitudes %}
            <tr>
              <td>
                <input class="rowcheck" type="checkbox" name="ids" value="{{ s.id }}">
              </td>
              <td>{{ s.id }}</td>
              <td>{{ s.dueno }}</td>
              <td>{{ s.tel }}</td>
              <td>{{ s.vivienda or "" }}</td>
              <td>{{ s.direccion or "" }}</td>
              <td>{{ s.torre or "" }}</td>
              <td>{{ s.apto or "" }}</td>
              <td>{{ s.instrucciones or "" }}</td>
              <td>{{ s.turno or "" }}</td>
              <td>{{ s.franja or "" }}</td>
              <td>{{ s.fecha or "" }}</td>
              <td>{{ s.mascota or "" }}</td>
              <td>{{ s.especie or "" }}</td>
              <td>{{ s.raza or "" }}</td>
              <td>{{ s.edad or "" }}</td>
              <td>{{ s.muestra or "" }}</td>
              <td>{{ s.muestra_cual or "" }}</td>
              <td>{{ s.condicion or "" }}</td>
              <td><span class="badge">{{ s.estado or "pendiente" }}</span></td>
              <td>{{ s.creado or "" }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </form>
  </section>

  <script>
    const checkAll = document.getElementById("checkAll");
    const checks = () => Array.from(document.querySelectorAll(".rowcheck"));
    const btn = document.getElementById("btnDelete");
    const count = document.getElementById("countSel");

    function refresh(){
      const n = checks().filter(c => c.checked).length;
      btn.disabled = n === 0;
      count.textContent = `${n} seleccionadas`;
      checkAll.checked = n > 0 && n === checks().length;
      checkAll.indeterminate = n > 0 && n < checks().length;
    }

    checkAll.addEventListener("change", () => {
      checks().forEach(c => c.checked = checkAll.checked);
      refresh();
    });

    checks().forEach(c => c.addEventListener("change", refresh));

    refresh();
  </script>
{% endblock %}

